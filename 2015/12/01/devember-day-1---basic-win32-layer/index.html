<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Devember Day 1 - Basic Win32 Layer &middot;  String Bulbs" />
  	<meta property="og:site_name" content="String Bulbs" />
  	<meta property="og:url" content="http://stringbulbs.com/2015/12/01/devember-day-1---basic-win32-layer/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2015-12-01T23:17:19&#43;08:00" />

    
    <meta property="og:article:tag" content="devember" />
    
    <meta property="og:article:tag" content="wastale" />
    
    

  <title>
     Devember Day 1 - Basic Win32 Layer &middot;  String Bulbs
  </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://stringbulbs.com/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://stringbulbs.com/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="http://stringbulbs.com/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://stringbulbs.com/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="http://stringbulbs.com/index.xml" rel="alternate" type="application/rss+xml" title="String Bulbs" />
      
      
    
    <meta name="generator" content="Hugo 0.14" />

    <link rel="canonical" href="http://stringbulbs.com/2015/12/01/devember-day-1---basic-win32-layer/" />

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://stringbulbs.com/">Home</a>
            </li>
        
            <h3>Team</h3>
            <li class="nav-opened" role="presentation">
            	<a href="">Tim Liou</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://stringbulbs.com/2015/11/11/the-beginning-of-tab/">Venses Tab</a>
            </li>
        
            <h3>Project</h3>
            <li class="nav-opened" role="presentation">
            	<a href="http://stringbulbs.com/tags/wastale/">Wastale</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="http://stringbulbs.com/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="http://stringbulbs.com/"><img src="http://stringbulbs.com/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Devember Day 1 - Basic Win32 Layer</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2015-12-01T23:17:19&#43;08:00">
            Dec 1, 2015
          </time>
        
         
          <span class="post-tag small"><a href="http://stringbulbs.com/tags/devember/">#devember</a></span>
         
          <span class="post-tag small"><a href="http://stringbulbs.com/tags/wastale/">#wastale</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<p>Last week, I spent some time reviewing the construction of Win32 prototyping
layer mentioned in Handmade Hero weeks 1 through 5. In those weeks, Casey talk
about some basic stuff that a game need - Graphic, Sound, and Input. If you are
interested in detail, I would recommend you to watch
<a href="https://hero.handmadedev.org/jace/guide/">Day 1 to 25 of Handmade Hero</a>.</p>

<p>Most codes of <code>win32_wastale.*</code> are as same as the codes in <code>win32_handmade.*</code>.
The most different part is the sound. I will talk about in the rest of the
article. By the way, the source code of wastale is on
<a href="https://github.com/wheatdog/wastale">Github</a> if you want to take a look.
Today&rsquo;s code is on
<a href="https://github.com/wheatdog/wastale/tree/devember_1">this tag</a>.</p>

<h1 id="xaudio2:38d4082b4e2ef27c7672bc7e5af08564">XAudio2</h1>

<p>Instead of using DirectSound, I choose XAudio2. There is only one ring buffer in
DirectSound. When we have reached the end of the buffer, we start from the
beginning. However, in XAudio2, we can submit several <code>XAUDIO2_BUFFER</code> through
<code>IXAudio2SourceVoice::SubmitSourceBuffer</code> method. Basicly, it is like a queue.
Each time we reach the end of a buffer, it will start playing the next buffer.</p>

<p>We can reduce the audio latency by keeping the same number of samples in the
queue. For example, Red line represent the frame boundary. Let&rsquo;s say that we run
in 30 frames per second and have 48000 samples per second. Therefore, there are
1600 samples per frame. Every time we write, we will make sure that the number
of samples in the audio queue are 2400, that is the number of samples in one and
a half frames.
<a href="https://flic.kr/p/BgS6Lj"><img src="https://farm6.staticflickr.com/5697/23152009310_c431845d73_o.png" alt="" />
</a>
Brown arrow represent the time that we first write to the sound buffer, and the
brown rounded rectangle near the black line represent the samples we write. Next
time we update samples at the time green arrow point to. To keep the number of
samples in the queue, we will only need to write the number of samples that
green rounded rectangle stand for. If we can update samples in the audio buffer
just in the middle of the frame like arrows in the image above. We can generate
enough samples for next frame and those samples will be played right on the
frame boundary.</p>

<p>Unfortunately, first we cannot guarantee we always update samples at the same
time. Therefore, sound boundary may not line up with the frame boudary, which I
think is fine. Second, <code>IXAudio2SourceVoice::GetState</code> cannot return the exactly
samples we just played without using callback. Its granularity is 480 samples in
my machine. That means that we might fill less sample than what we really need
to. The worst case is that we will have the gap of 480 samples.</p>

<p>The easy way to solve this problem is to make the number we want to keep in the
queue larger. Another solution will be using callback which I am really not
familiar with. I think the latency right now is fine for a prototyping
layer. Therefore, I will move on to deal with other problem.</p>

<h1 id="tomorrow:38d4082b4e2ef27c7672bc7e5af08564">Tomorrow</h1>

<p>I will try to implement &ldquo;Live Code Editing&rdquo; feature Casey talked about in
Handmade Hero Week 5 tomorrow. Then, maybe start game engine code exploration
Thursday. Until then!</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="http://stringbulbs.com/" style="background-image: url(http://stringbulbs.com/images/logo.png)"><span class="hidden">'s Picture</span></a>
    </figure>
    

    





<section class="author">
  <h4><a href="http://stringbulbs.com/">Tim Liou</a></h4>
  
  <p>A college student who has a passion for indie games.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Taiwan</span>
    <span class="author-link icon-link"><a href="http://twitter.com/wdliou">http://twitter.com/wdliou</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Devember%20Day%201%20-%20Basic%20Win32%20Layer&amp;url=http%3a%2f%2fstringbulbs.com%2f2015%2f12%2f01%2fdevember-day-1---basic-win32-layer%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fstringbulbs.com%2f2015%2f12%2f01%2fdevember-day-1---basic-win32-layer%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fstringbulbs.com%2f2015%2f12%2f01%2fdevember-day-1---basic-win32-layer%2f&amp;description=Devember%20Day%201%20-%20Basic%20Win32%20Layer"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fstringbulbs.com%2f2015%2f12%2f01%2fdevember-day-1---basic-win32-layer%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">String Bulbs</a> All rights reserved - 2015</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://stringbulbs.com/js/jquery.js"></script>
    <script type="text/javascript" src="http://stringbulbs.com/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://stringbulbs.com/js/index.js"></script>
    
</body>
</html>

